/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, Inject, Input, Output, ViewChild, ChangeDetectionStrategy, EventEmitter, Renderer2, ViewEncapsulation, NgZone } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { fromEvent, of, EMPTY } from 'rxjs';
import { delay, expand, map, mergeMap, takeUntil, takeWhile, tap } from 'rxjs/operators';
export class ScrollbarComponent {
    /**
     * @param {?} zone
     * @param {?} renderer
     * @param {?} document
     */
    constructor(zone, renderer, document) {
        this.zone = zone;
        this.renderer = renderer;
        this.document = document;
        this._thumbSizeY = 0;
        this._thumbSizeX = 0;
        this._trackTopMax = 0;
        this._trackLeftMax = 0;
        this._scrollLeftMax = 0;
        this._scrollTopMax = 0;
        this._naturalThumbSizeY = 0;
        this._naturalThumbSizeX = 0;
        this._currXPos = 0;
        this._currYPos = 0;
        this._minThumbSize = 20;
        this.autoUpdate = true;
        this.autoHide = false;
        this.trackX = false;
        this.trackY = true;
        this.scrollState = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.zone.runOutsideAngular(() => {
            this.barX = this.barXRef.nativeElement;
            this.barY = this.barYRef.nativeElement;
            this.thumbX = this.thumbXRef.nativeElement;
            this.thumbY = this.thumbYRef.nativeElement;
            this.view = this.viewRef.nativeElement;
            this.hideNativeScrollbars();
            /** Initialize scrollbars */
            this.scrollWorker(null);
            this._scrollSub$ = fromEvent(this.view, 'scroll').pipe(tap((e) => this.scrollWorker(e))).subscribe();
            if (this.trackX) {
                this._barXSub$ = fromEvent(this.barX, 'mousedown').pipe(tap((e) => this.barXWorker(e))).subscribe();
                this._thumbXSub$ = this.startThumbXWorker();
            }
            if (this.trackY) {
                this._barYSub$ = fromEvent(this.barY, 'mousedown').pipe(tap((e) => this.barYWorker(e))).subscribe();
                this._thumbYSub$ = this.startThumbYWorker();
            }
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this._scrollSub$) {
            this._scrollSub$.unsubscribe();
        }
        if (this.trackX) {
            this._barXSub$.unsubscribe();
            this._thumbXSub$.unsubscribe();
        }
        if (this.trackY) {
            this._barYSub$.unsubscribe();
            this._thumbYSub$.unsubscribe();
        }
    }
    /**
     * Scroll horizontally
     * @param {?} to
     * @param {?=} duration
     * @return {?}
     */
    scrollXTo(to, duration) {
        if (duration) {
            of(duration).pipe(takeWhile(() => duration > 0), expand((d) => {
                if (d > 0) {
                    const /** @type {?} */ difference = to - this.view.scrollLeft;
                    const /** @type {?} */ perTick = difference / d * 10;
                    this.renderer.setProperty(this.view, 'scrollLeft', this.view.scrollLeft + perTick);
                    return of(d - 10).pipe(delay(10));
                }
                else {
                    duration = d;
                    return EMPTY;
                }
            })).subscribe();
        }
        else {
            this.renderer.setProperty(this.view, 'scrollLeft', to);
        }
    }
    /**
     * Scroll vertically
     * @param {?} to
     * @param {?=} duration
     * @return {?}
     */
    scrollYTo(to, duration) {
        if (duration) {
            of(duration).pipe(takeWhile(() => duration > 0), expand((d) => {
                if (d > 0) {
                    const /** @type {?} */ difference = to - this.view.scrollTop;
                    const /** @type {?} */ perTick = difference / d * 10;
                    this.renderer.setProperty(this.view, 'scrollTop', this.view.scrollTop + perTick);
                    return of(d - 10).pipe(delay(10));
                }
                else {
                    duration = d;
                    return EMPTY;
                }
            })).subscribe();
        }
        else {
            this.renderer.setProperty(this.view, 'scrollTop', to);
        }
    }
    /**
     * Scroll view to top
     * @param {?=} duration
     * @return {?}
     */
    scrollToTop(duration) {
        this.scrollYTo(0, duration);
    }
    /**
     * Scroll view to bottom
     * @param {?=} duration
     * @return {?}
     */
    scrollToBottom(duration) {
        this.scrollYTo(this.view.scrollHeight, duration);
    }
    /**
     * Scroll view to max right
     * @param {?=} duration
     * @return {?}
     */
    scrollToRight(duration) {
        this.scrollXTo(this.view.scrollWidth, duration);
    }
    /**
     * Scroll view to max left
     * @param {?=} duration
     * @return {?}
     */
    scrollToLeft(duration) {
        this.scrollXTo(0, duration);
    }
    /**
     * Update thumbnails
     * @return {?}
     */
    update() {
        this.setThumbXPosition(this._currXPos, this.calculateThumbXSize());
        this.setThumbYPosition(this._currYPos, this.calculateThumbYSize());
    }
    /**
     * Scroll Worker
     * @param {?} e - Mouse Event
     * @return {?}
     */
    scrollWorker(e) {
        this._thumbSizeX = this.thumbX.clientWidth;
        this._thumbSizeY = this.thumbY.clientHeight;
        this._trackLeftMax = this.barX.clientWidth - this._thumbSizeX;
        this._trackTopMax = this.barY.clientHeight - this._thumbSizeY;
        const /** @type {?} */ thumbXPosition = this.view.scrollLeft * this._trackLeftMax / this._scrollLeftMax;
        const /** @type {?} */ thumbYPosition = this.view.scrollTop * this._trackTopMax / this._scrollTopMax;
        this.setThumbXPosition(thumbXPosition, this.calculateThumbXSize());
        this.setThumbYPosition(thumbYPosition, this.calculateThumbYSize());
        /** Emit scroll state */
        this.scrollState.emit(e);
    }
    /**
     * Horizontal scrollbar click worker
     * @param {?} e - Mouse Event
     * @return {?}
     */
    barXWorker(e) {
        if (e.target === e.currentTarget) {
            const /** @type {?} */ offset = e.offsetX - this._naturalThumbSizeX * .5;
            const /** @type {?} */ thumbPositionPercentage = offset * 100 / this.barX.clientWidth;
            const /** @type {?} */ scrollLeft = thumbPositionPercentage * this.view.scrollWidth / 100;
            this.renderer.setProperty(this.view, 'scrollLeft', scrollLeft);
        }
    }
    /**
     * Vertical scrollbar click worker
     * @param {?} e - Mouse Event
     * @return {?}
     */
    barYWorker(e) {
        if (e.target === e.currentTarget) {
            const /** @type {?} */ offset = e.offsetY - this._naturalThumbSizeY * .5;
            const /** @type {?} */ thumbPositionPercentage = offset * 100 / this.barY.clientHeight;
            const /** @type {?} */ scrollTop = thumbPositionPercentage * this.view.scrollHeight / 100;
            this.renderer.setProperty(this.view, 'scrollTop', scrollTop);
        }
    }
    /**
     * Start horizontal thumb worker
     * @return {?}
     */
    startThumbXWorker() {
        const /** @type {?} */ mousedown$ = fromEvent(this.thumbX, 'mousedown');
        const /** @type {?} */ mouseup$ = fromEvent(this.document, 'mouseup');
        const /** @type {?} */ mousemove$ = fromEvent(this.document, 'mousemove');
        return mousedown$.pipe(tap(() => this.document.onselectstart = () => false), map((mousedownEvent) => mousedownEvent.offsetX), mergeMap((mousedownOffsetX) => mousemove$.pipe(takeUntil(mouseup$.pipe(tap(() => this.document.onselectstart = null))), map((mousemoveEvent) => mousemoveEvent.clientX), tap((mousemoveClientX) => {
            const /** @type {?} */ offset = mousemoveClientX - this.barX.getBoundingClientRect().left;
            const /** @type {?} */ scroll = this._scrollLeftMax * (offset - mousedownOffsetX) / this._trackLeftMax;
            this.renderer.setProperty(this.view, 'scrollLeft', scroll);
        })))).subscribe();
    }
    /**
     * Start vertical thumb worker
     * @return {?}
     */
    startThumbYWorker() {
        const /** @type {?} */ mousedown$ = fromEvent(this.thumbY, 'mousedown');
        const /** @type {?} */ mouseup$ = fromEvent(this.document, 'mouseup');
        const /** @type {?} */ mousemove$ = fromEvent(this.document, 'mousemove');
        return mousedown$.pipe(tap(() => this.document.onselectstart = () => false), map((mousedownEvent) => mousedownEvent.offsetY), mergeMap((mousedownOffsetY) => mousemove$.pipe(takeUntil(mouseup$.pipe(tap(() => this.document.onselectstart = null))), map((mousemoveEvent) => mousemoveEvent.clientY), tap((mousemoveClientY) => {
            const /** @type {?} */ offset = mousemoveClientY - this.barY.getBoundingClientRect().top;
            const /** @type {?} */ scroll = this._scrollTopMax * (offset - mousedownOffsetY) / this._trackTopMax;
            this.renderer.setProperty(this.view, 'scrollTop', scroll);
        })))).subscribe();
    }
    /**
     * Calculate Thumb X Size
     * @return {?}
     */
    calculateThumbXSize() {
        this._naturalThumbSizeX = this.barX.clientWidth / this.view.scrollWidth * this.barX.clientWidth;
        this._scrollLeftMax = this.view.scrollWidth - this.view.clientWidth;
        return this.scrollBoundaries(this._naturalThumbSizeX, this._scrollLeftMax);
    }
    /**
     * Calculate Thumb Y Size
     * @return {?}
     */
    calculateThumbYSize() {
        this._naturalThumbSizeY = this.barY.clientHeight / this.view.scrollHeight * this.barY.clientHeight;
        this._scrollTopMax = this.view.scrollHeight - this.view.clientHeight;
        return this.scrollBoundaries(this._naturalThumbSizeY, this._scrollTopMax);
    }
    /**
     * Get scrollbar thumb size
     * @param {?} naturalThumbSize
     * @param {?} scrollMax
     * @return {?}
     */
    scrollBoundaries(naturalThumbSize, scrollMax) {
        return (naturalThumbSize < this._minThumbSize) ? this._minThumbSize : scrollMax ? naturalThumbSize : 0;
    }
    /**
     * Set horizontal scrollbar thumb style
     * @param {?} x
     * @param {?} width
     * @return {?}
     */
    setThumbXPosition(x, width) {
        const /** @type {?} */ transform = `translate3d(${x}px, 0, 0)`;
        this.renderer.setStyle(this.thumbX, 'transform', transform);
        this.renderer.setStyle(this.thumbX, 'width', width + 'px');
        this._currXPos = x;
    }
    /**
     * Set vertical scrollbar thumb style
     * @param {?} y
     * @param {?} height
     * @return {?}
     */
    setThumbYPosition(y, height) {
        const /** @type {?} */ transform = `translate3d(0, ${y}px, 0)`;
        this.renderer.setStyle(this.thumbY, 'transform', transform);
        this.renderer.setStyle(this.thumbY, 'height', height + 'px');
        this._currYPos = y;
    }
    /**
     * Hide native scrollbars
     * @return {?}
     */
    hideNativeScrollbars() {
        const /** @type {?} */ size = `calc(100% + ${this.getNativeScrollbarWidth()}px)`;
        this.renderer.setStyle(this.view, 'width', size);
        this.renderer.setStyle(this.view, 'height', size);
    }
    /**
     * Get the native scrollbar width
     * @return {?}
     */
    getNativeScrollbarWidth() {
        const /** @type {?} */ element = this.document.createElement('div');
        element.style.position = 'absolute';
        element.style.top = '-9999px';
        element.style.width = '100px';
        element.style.height = '100px';
        element.style.overflow = 'scroll';
        element.style.msOverflowStyle = 'scrollbar';
        this.document.body.appendChild(element);
        const /** @type {?} */ sw = element.offsetWidth - element.clientWidth;
        this.document.body.removeChild(element);
        return sw;
    }
}
ScrollbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'ng-scrollbar',
                template: `<div class="ng-scrollbar-container" [class.ng-scrollbar-autohide]="autoHide">

  <div #barX class="ng-scrollbar -horizontal {{barClass}}" [class.ng-scrollbar-disabled]="!trackX">
    <div #thumbX class="ng-scrollbar-thumb {{thumbClass}}"></div>
  </div>

  <div #barY class="ng-scrollbar -vertical {{barClass}}" [class.ng-scrollbar-disabled]="!trackY">
    <div #thumbY class="ng-scrollbar-thumb {{thumbClass}}"></div>
  </div>

  <div #view class="ng-scrollbar-view {{viewClass}}"
       (cdkObserveContent)="update()"
       [cdkObserveContentDisabled]="autoUpdate">
    <ng-content></ng-content>
  </div>
</div>
`,
                styles: [`ng-scrollbar{display:block;position:relative;height:100%;overflow:hidden!important}.ng-scrollbar-container{position:relative;overflow:hidden!important;width:100%;height:100%}.ng-scrollbar-autohide>.ng-scrollbar{opacity:0;transition:opacity 120ms ease-out}.ng-scrollbar-autohide:active>.ng-scrollbar,.ng-scrollbar-autohide:focus>.ng-scrollbar,.ng-scrollbar-autohide:hover>.ng-scrollbar{opacity:1;transition:opacity 340ms ease-out}.ng-scrollbar{position:absolute;right:2px;bottom:2px;z-index:1;border-radius:3px}.-vertical{width:6px;top:2px}.-vertical .ng-scrollbar-thumb{width:100%}.-horizontal{height:6px;left:2px}.-horizontal .ng-scrollbar-thumb{height:100%}.ng-scrollbar-disabled{display:none}.ng-scrollbar-thumb{position:relative;display:block;width:0;height:0;border-radius:inherit;background-color:rgba(0,0,0,.2);-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}.ng-scrollbar-thumb:active,.ng-scrollbar-thumb:hover{background-color:rgba(0,0,0,.3)}.ng-scrollbar-view{width:100%;height:100%;overflow:scroll;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-overflow-scrolling:touch}`],
                changeDetection: ChangeDetectionStrategy.OnPush,
                encapsulation: ViewEncapsulation.None,
                preserveWhitespaces: false
            },] },
];
/** @nocollapse */
ScrollbarComponent.ctorParameters = () => [
    { type: NgZone, },
    { type: Renderer2, },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] },] },
];
ScrollbarComponent.propDecorators = {
    "barXRef": [{ type: ViewChild, args: ['barX',] },],
    "barYRef": [{ type: ViewChild, args: ['barY',] },],
    "thumbXRef": [{ type: ViewChild, args: ['thumbX',] },],
    "thumbYRef": [{ type: ViewChild, args: ['thumbY',] },],
    "viewRef": [{ type: ViewChild, args: ['view',] },],
    "autoUpdate": [{ type: Input },],
    "autoHide": [{ type: Input },],
    "trackX": [{ type: Input },],
    "trackY": [{ type: Input },],
    "viewClass": [{ type: Input },],
    "barClass": [{ type: Input },],
    "thumbClass": [{ type: Input },],
    "scrollState": [{ type: Output },],
};
function ScrollbarComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    ScrollbarComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    ScrollbarComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    ScrollbarComponent.propDecorators;
    /** @type {?} */
    ScrollbarComponent.prototype._thumbSizeY;
    /** @type {?} */
    ScrollbarComponent.prototype._thumbSizeX;
    /** @type {?} */
    ScrollbarComponent.prototype._trackTopMax;
    /** @type {?} */
    ScrollbarComponent.prototype._trackLeftMax;
    /** @type {?} */
    ScrollbarComponent.prototype._scrollLeftMax;
    /** @type {?} */
    ScrollbarComponent.prototype._scrollTopMax;
    /** @type {?} */
    ScrollbarComponent.prototype._naturalThumbSizeY;
    /** @type {?} */
    ScrollbarComponent.prototype._naturalThumbSizeX;
    /** @type {?} */
    ScrollbarComponent.prototype._currXPos;
    /** @type {?} */
    ScrollbarComponent.prototype._currYPos;
    /** @type {?} */
    ScrollbarComponent.prototype._minThumbSize;
    /** @type {?} */
    ScrollbarComponent.prototype._scrollSub$;
    /** @type {?} */
    ScrollbarComponent.prototype._barXSub$;
    /** @type {?} */
    ScrollbarComponent.prototype._barYSub$;
    /** @type {?} */
    ScrollbarComponent.prototype._thumbXSub$;
    /** @type {?} */
    ScrollbarComponent.prototype._thumbYSub$;
    /** @type {?} */
    ScrollbarComponent.prototype.barX;
    /** @type {?} */
    ScrollbarComponent.prototype.barY;
    /** @type {?} */
    ScrollbarComponent.prototype.thumbX;
    /** @type {?} */
    ScrollbarComponent.prototype.thumbY;
    /** @type {?} */
    ScrollbarComponent.prototype.view;
    /** @type {?} */
    ScrollbarComponent.prototype.barXRef;
    /** @type {?} */
    ScrollbarComponent.prototype.barYRef;
    /** @type {?} */
    ScrollbarComponent.prototype.thumbXRef;
    /** @type {?} */
    ScrollbarComponent.prototype.thumbYRef;
    /** @type {?} */
    ScrollbarComponent.prototype.viewRef;
    /** @type {?} */
    ScrollbarComponent.prototype.autoUpdate;
    /** @type {?} */
    ScrollbarComponent.prototype.autoHide;
    /** @type {?} */
    ScrollbarComponent.prototype.trackX;
    /** @type {?} */
    ScrollbarComponent.prototype.trackY;
    /** @type {?} */
    ScrollbarComponent.prototype.viewClass;
    /** @type {?} */
    ScrollbarComponent.prototype.barClass;
    /** @type {?} */
    ScrollbarComponent.prototype.thumbClass;
    /** @type {?} */
    ScrollbarComponent.prototype.scrollState;
    /** @type {?} */
    ScrollbarComponent.prototype.zone;
    /** @type {?} */
    ScrollbarComponent.prototype.renderer;
    /** @type {?} */
    ScrollbarComponent.prototype.document;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsYmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1zY3JvbGxiYXIvIiwic291cmNlcyI6WyJsaWIvc2Nyb2xsYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxNQUFNLEVBR04sS0FBSyxFQUNMLE1BQU0sRUFDTixTQUFTLEVBQ1QsdUJBQXVCLEVBQ3ZCLFlBQVksRUFDWixTQUFTLEVBQ1QsaUJBQWlCLEVBQ2pCLE1BQU0sRUFDUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFnQixTQUFTLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUEwQnpGLE1BQU07Ozs7OztJQXdDSixZQUFvQixJQUFZLEVBQVUsUUFBbUIsRUFBNEI7UUFBckUsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBNEIsYUFBUSxHQUFSLFFBQVE7MkJBdEMzRSxDQUFDOzJCQUNELENBQUM7NEJBQ0EsQ0FBQzs2QkFDQSxDQUFDOzhCQUNBLENBQUM7NkJBQ0YsQ0FBQztrQ0FDSSxDQUFDO2tDQUNELENBQUM7eUJBQ1YsQ0FBQzt5QkFDRCxDQUFDOzZCQUNHLEVBQUU7MEJBbUJKLElBQUk7d0JBQ04sS0FBSztzQkFDUCxLQUFLO3NCQUNMLElBQUk7MkJBSUUsSUFBSSxZQUFZLEVBQU87S0FHOUM7Ozs7SUFFRCxlQUFlO1FBRWIsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7WUFDL0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJ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LENBQUM7UUFDbEMsT0FBTyxDQUFDLEtBQUssQ0FBQyxlQUFlLEdBQUcsV0FBVyxDQUFDO1FBQzVDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4Qyx1QkFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDO1FBQ3JELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4QyxNQUFNLENBQUMsRUFBRSxDQUFDOzs7O1lBNVdiLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsY0FBYztnQkFDeEIsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7O0NBZ0JYO2dCQUNDLE1BQU0sRUFBRSxDQUFDLHdtQ0FBd21DLENBQUM7Z0JBQ2xuQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtnQkFDL0MsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7Z0JBQ3JDLG1CQUFtQixFQUFFLEtBQUs7YUFDM0I7Ozs7WUE3QkMsTUFBTTtZQUZOLFNBQVM7NENBd0V1RCxNQUFNLFNBQUMsUUFBUTs7O3dCQWY5RSxTQUFTLFNBQUMsTUFBTTt3QkFDaEIsU0FBUyxTQUFDLE1BQU07MEJBQ2hCLFNBQVMsU0FBQyxRQUFROzBCQUNsQixTQUFTLFNBQUMsUUFBUTt3QkFDbEIsU0FBUyxTQUFDLE1BQU07MkJBRWhCLEtBQUs7eUJBQ0wsS0FBSzt1QkFDTCxLQUFLO3VCQUNMLEtBQUs7MEJBQ0wsS0FBSzt5QkFDTCxLQUFLOzJCQUNMLEtBQUs7NEJBQ0wsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIEluamVjdCxcclxuICBBZnRlclZpZXdJbml0LFxyXG4gIE9uRGVzdHJveSxcclxuICBJbnB1dCxcclxuICBPdXRwdXQsXHJcbiAgVmlld0NoaWxkLFxyXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBSZW5kZXJlcjIsXHJcbiAgVmlld0VuY2Fwc3VsYXRpb24sXHJcbiAgTmdab25lXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCBmcm9tRXZlbnQsIG9mLCBFTVBUWSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWxheSwgZXhwYW5kLCBtYXAsIG1lcmdlTWFwLCB0YWtlVW50aWwsIHRha2VXaGlsZSwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICduZy1zY3JvbGxiYXInLFxyXG4gIHRlbXBsYXRlOiBgPGRpdiBjbGFzcz1cIm5nLXNjcm9sbGJhci1jb250YWluZXJcIiBbY2xhc3Mubmctc2Nyb2xsYmFyLWF1dG9oaWRlXT1cImF1dG9IaWRlXCI+XHJcblxyXG4gIDxkaXYgI2JhclggY2xhc3M9XCJuZy1zY3JvbGxiYXIgLWhvcml6b250YWwge3tiYXJDbGFzc319XCIgW2NsYXNzLm5nLXNjcm9sbGJhci1kaXNhYmxlZF09XCIhdHJhY2tYXCI+XHJcbiAgICA8ZGl2ICN0aHVtYlggY2xhc3M9XCJuZy1zY3JvbGxiYXItdGh1bWIge3t0aHVtYkNsYXNzfX1cIj48L2Rpdj5cclxuICA8L2Rpdj5cclxuXHJcbiAgPGRpdiAjYmFyWSBjbGFzcz1cIm5nLXNjcm9sbGJhciAtdmVydGljYWwge3tiYXJDbGFzc319XCIgW2NsYXNzLm5nLXNjcm9sbGJhci1kaXNhYmxlZF09XCIhdHJhY2tZXCI+XHJcbiAgICA8ZGl2ICN0aHVtYlkgY2xhc3M9XCJuZy1zY3JvbGxiYXItdGh1bWIge3t0aHVtYkNsYXNzfX1cIj48L2Rpdj5cclxuICA8L2Rpdj5cclxuXHJcbiAgPGRpdiAjdmlldyBjbGFzcz1cIm5nLXNjcm9sbGJhci12aWV3IHt7dmlld0NsYXNzfX1cIlxyXG4gICAgICAgKGNka09ic2VydmVDb250ZW50KT1cInVwZGF0ZSgpXCJcclxuICAgICAgIFtjZGtPYnNlcnZlQ29udGVudERpc2FibGVkXT1cImF1dG9VcGRhdGVcIj5cclxuICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cclxuICA8L2Rpdj5cclxuPC9kaXY+XHJcbmAsXHJcbiAgc3R5bGVzOiBbYG5nLXNjcm9sbGJhcntkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDoxMDAlO292ZXJmbG93OmhpZGRlbiFpbXBvcnRhbnR9Lm5nLXNjcm9sbGJhci1jb250YWluZXJ7cG9zaXRpb246cmVsYXRpdmU7b3ZlcmZsb3c6aGlkZGVuIWltcG9ydGFudDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlfS5uZy1zY3JvbGxiYXItYXV0b2hpZGU+Lm5nLXNjcm9sbGJhcntvcGFjaXR5OjA7dHJhbnNpdGlvbjpvcGFjaXR5IDEyMG1zIGVhc2Utb3V0fS5uZy1zY3JvbGxiYXItYXV0b2hpZGU6YWN0aXZlPi5uZy1zY3JvbGxiYXIsLm5nLXNjcm9sbGJhci1hdXRvaGlkZTpmb2N1cz4ubmctc2Nyb2xsYmFyLC5uZy1zY3JvbGxiYXItYXV0b2hpZGU6aG92ZXI+Lm5nLXNjcm9sbGJhcntvcGFjaXR5OjE7dHJhbnNpdGlvbjpvcGFjaXR5IDM0MG1zIGVhc2Utb3V0fS5uZy1zY3JvbGxiYXJ7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MnB4O2JvdHRvbToycHg7ei1pbmRleDoxO2JvcmRlci1yYWRpdXM6M3B4fS4tdmVydGljYWx7d2lkdGg6NnB4O3RvcDoycHh9Li12ZXJ0aWNhbCAubmctc2Nyb2xsYmFyLXRodW1ie3dpZHRoOjEwMCV9Li1ob3Jpem9udGFse2hlaWdodDo2cHg7bGVmdDoycHh9Li1ob3Jpem9udGFsIC5uZy1zY3JvbGxiYXItdGh1bWJ7aGVpZ2h0OjEwMCV9Lm5nLXNjcm9sbGJhci1kaXNhYmxlZHtkaXNwbGF5Om5vbmV9Lm5nLXNjcm9sbGJhci10aHVtYntwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmJsb2NrO3dpZHRoOjA7aGVpZ2h0OjA7Ym9yZGVyLXJhZGl1czppbmhlcml0O2JhY2tncm91bmQtY29sb3I6cmdiYSgwLDAsMCwuMik7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwwLDApO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLDAsMCl9Lm5nLXNjcm9sbGJhci10aHVtYjphY3RpdmUsLm5nLXNjcm9sbGJhci10aHVtYjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOnJnYmEoMCwwLDAsLjMpfS5uZy1zY3JvbGxiYXItdmlld3t3aWR0aDoxMDAlO2hlaWdodDoxMDAlO292ZXJmbG93OnNjcm9sbDstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLDAsMCk7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsMCwwKTstd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzp0b3VjaH1gXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gIHByZXNlcnZlV2hpdGVzcGFjZXM6IGZhbHNlXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTY3JvbGxiYXJDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICBwcml2YXRlIF90aHVtYlNpemVZID0gMDtcclxuICBwcml2YXRlIF90aHVtYlNpemVYID0gMDtcclxuICBwcml2YXRlIF90cmFja1RvcE1heCA9IDA7XHJcbiAgcHJpdmF0ZSBfdHJhY2tMZWZ0TWF4ID0gMDtcclxuICBwcml2YXRlIF9zY3JvbGxMZWZ0TWF4ID0gMDtcclxuICBwcml2YXRlIF9zY3JvbGxUb3BNYXggPSAwO1xyXG4gIHByaXZhdGUgX25hdHVyYWxUaHVtYlNpemVZID0gMDtcclxuICBwcml2YXRlIF9uYXR1cmFsVGh1bWJTaXplWCA9IDA7XHJcbiAgcHJpdmF0ZSBfY3VyclhQb3MgPSAwO1xyXG4gIHByaXZhdGUgX2N1cnJZUG9zID0gMDtcclxuICBwcml2YXRlIF9taW5UaHVtYlNpemUgPSAyMDtcclxuICBwcml2YXRlIF9zY3JvbGxTdWIkOiBTdWJzY3JpcHRpb247XHJcbiAgcHJpdmF0ZSBfYmFyWFN1YiQ6IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIF9iYXJZU3ViJDogU3Vic2NyaXB0aW9uO1xyXG4gIHByaXZhdGUgX3RodW1iWFN1YiQ6IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIF90aHVtYllTdWIkOiBTdWJzY3JpcHRpb247XHJcblxyXG4gIGJhclg6IEhUTUxFbGVtZW50O1xyXG4gIGJhclk6IEhUTUxFbGVtZW50O1xyXG4gIHRodW1iWDogSFRNTEVsZW1lbnQ7XHJcbiAgdGh1bWJZOiBIVE1MRWxlbWVudDtcclxuICB2aWV3OiBIVE1MRWxlbWVudDtcclxuXHJcbiAgQFZpZXdDaGlsZCgnYmFyWCcpIGJhclhSZWY7XHJcbiAgQFZpZXdDaGlsZCgnYmFyWScpIGJhcllSZWY7XHJcbiAgQFZpZXdDaGlsZCgndGh1bWJYJykgdGh1bWJYUmVmO1xyXG4gIEBWaWV3Q2hpbGQoJ3RodW1iWScpIHRodW1iWVJlZjtcclxuICBAVmlld0NoaWxkKCd2aWV3Jykgdmlld1JlZjtcclxuXHJcbiAgQElucHV0KCkgYXV0b1VwZGF0ZSA9IHRydWU7XHJcbiAgQElucHV0KCkgYXV0b0hpZGUgPSBmYWxzZTtcclxuICBASW5wdXQoKSB0cmFja1ggPSBmYWxzZTtcclxuICBASW5wdXQoKSB0cmFja1kgPSB0cnVlO1xyXG4gIEBJbnB1dCgpIHZpZXdDbGFzczogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIGJhckNsYXNzOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgdGh1bWJDbGFzczogc3RyaW5nO1xyXG4gIEBPdXRwdXQoKSBzY3JvbGxTdGF0ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHpvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50OiBhbnkpIHtcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuXHJcbiAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICB0aGlzLmJhclggPSB0aGlzLmJhclhSZWYubmF0aXZlRWxlbWVudDtcclxuICAgICAgdGhpcy5iYXJZID0gdGhpcy5iYXJZUmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgIHRoaXMudGh1bWJYID0gdGhpcy50aHVtYlhSZWYubmF0aXZlRWxlbWVudDtcclxuICAgICAgdGhpcy50aHVtYlkgPSB0aGlzLnRodW1iWVJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgICB0aGlzLnZpZXcgPSB0aGlzLnZpZXdSZWYubmF0aXZlRWxlbWVudDtcclxuXHJcbiAgICAgIHRoaXMuaGlkZU5hdGl2ZVNjcm9sbGJhcnMoKTtcclxuXHJcbiAgICAgIC8qKiBJbml0aWFsaXplIHNjcm9sbGJhcnMgKi9cclxuICAgICAgdGhpcy5zY3JvbGxXb3JrZXIobnVsbCk7XHJcblxyXG4gICAgICB0aGlzLl9zY3JvbGxTdWIkID0gZnJvbUV2ZW50KHRoaXMudmlldywgJ3Njcm9sbCcpLnBpcGUodGFwKChlKSA9PiB0aGlzLnNjcm9sbFdvcmtlcihlKSkpLnN1YnNjcmliZSgpO1xyXG4gICAgICBpZiAodGhpcy50cmFja1gpIHtcclxuICAgICAgICB0aGlzLl9iYXJYU3ViJCA9IGZyb21FdmVudCh0aGlzLmJhclgsICdtb3VzZWRvd24nKS5waXBlKHRhcCgoZSkgPT4gdGhpcy5iYXJYV29ya2VyKGUpKSkuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgdGhpcy5fdGh1bWJYU3ViJCA9IHRoaXMuc3RhcnRUaHVtYlhXb3JrZXIoKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy50cmFja1kpIHtcclxuICAgICAgICB0aGlzLl9iYXJZU3ViJCA9IGZyb21FdmVudCh0aGlzLmJhclksICdtb3VzZWRvd24nKS5waXBlKHRhcCgoZSkgPT4gdGhpcy5iYXJZV29ya2VyKGUpKSkuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgdGhpcy5fdGh1bWJZU3ViJCA9IHRoaXMuc3RhcnRUaHVtYllXb3JrZXIoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIGlmICh0aGlzLl9zY3JvbGxTdWIkKSB7XHJcbiAgICAgIHRoaXMuX3Njcm9sbFN1YiQudW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnRyYWNrWCkge1xyXG4gICAgICB0aGlzLl9iYXJYU3ViJC51bnN1YnNjcmliZSgpO1xyXG4gICAgICB0aGlzLl90aHVtYlhTdWIkLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy50cmFja1kpIHtcclxuICAgICAgdGhpcy5fYmFyWVN1YiQudW5zdWJzY3JpYmUoKTtcclxuICAgICAgdGhpcy5fdGh1bWJZU3ViJC51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2Nyb2xsIGhvcml6b250YWxseVxyXG4gICAqIEBwYXJhbSB0b1xyXG4gICAqIEBwYXJhbSBkdXJhdGlvblxyXG4gICAqL1xyXG4gIHNjcm9sbFhUbyh0bzogbnVtYmVyLCBkdXJhdGlvbj86IG51bWJlcikge1xyXG4gICAgaWYgKGR1cmF0aW9uKSB7XHJcbiAgICAgIG9mKGR1cmF0aW9uKS5waXBlKFxyXG4gICAgICAgIHRha2VXaGlsZSgoKSA9PiBkdXJhdGlvbiA+IDApLFxyXG4gICAgICAgIGV4cGFuZCgoZDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICBpZiAoZCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgZGlmZmVyZW5jZSA9IHRvIC0gdGhpcy52aWV3LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHBlclRpY2sgPSBkaWZmZXJlbmNlIC8gZCAqIDEwO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMudmlldywgJ3Njcm9sbExlZnQnLCB0aGlzLnZpZXcuc2Nyb2xsTGVmdCArIHBlclRpY2spO1xyXG4gICAgICAgICAgICByZXR1cm4gb2YoZCAtIDEwKS5waXBlKGRlbGF5KDEwKSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkdXJhdGlvbiA9IGQ7XHJcbiAgICAgICAgICAgIHJldHVybiBFTVBUWTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICApLnN1YnNjcmliZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLnZpZXcsICdzY3JvbGxMZWZ0JywgdG8pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2Nyb2xsIHZlcnRpY2FsbHlcclxuICAgKiBAcGFyYW0gdG9cclxuICAgKiBAcGFyYW0gZHVyYXRpb25cclxuICAgKi9cclxuICBzY3JvbGxZVG8odG86IG51bWJlciwgZHVyYXRpb24/OiBudW1iZXIpIHtcclxuICAgIGlmIChkdXJhdGlvbikge1xyXG4gICAgICBvZihkdXJhdGlvbikucGlwZShcclxuICAgICAgICB0YWtlV2hpbGUoKCkgPT4gZHVyYXRpb24gPiAwKSxcclxuICAgICAgICBleHBhbmQoKGQ6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgaWYgKGQgPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpZmZlcmVuY2UgPSB0byAtIHRoaXMudmlldy5zY3JvbGxUb3A7XHJcbiAgICAgICAgICAgIGNvbnN0IHBlclRpY2sgPSBkaWZmZXJlbmNlIC8gZCAqIDEwO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMudmlldywgJ3Njcm9sbFRvcCcsIHRoaXMudmlldy5zY3JvbGxUb3AgKyBwZXJUaWNrKTtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKGQgLSAxMCkucGlwZShkZWxheSgxMCkpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZHVyYXRpb24gPSBkO1xyXG4gICAgICAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgKS5zdWJzY3JpYmUoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy52aWV3LCAnc2Nyb2xsVG9wJywgdG8pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2Nyb2xsIHZpZXcgdG8gdG9wXHJcbiAgICogQHBhcmFtIGR1cmF0aW9uXHJcbiAgICovXHJcbiAgc2Nyb2xsVG9Ub3AoZHVyYXRpb24/OiBudW1iZXIpIHtcclxuICAgIHRoaXMuc2Nyb2xsWVRvKDAsIGR1cmF0aW9uKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNjcm9sbCB2aWV3IHRvIGJvdHRvbVxyXG4gICAqIEBwYXJhbSBkdXJhdGlvblxyXG4gICAqL1xyXG4gIHNjcm9sbFRvQm90dG9tKGR1cmF0aW9uPzogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnNjcm9sbFlUbyh0aGlzLnZpZXcuc2Nyb2xsSGVpZ2h0LCBkdXJhdGlvbik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTY3JvbGwgdmlldyB0byBtYXggcmlnaHRcclxuICAgKiBAcGFyYW0gZHVyYXRpb25cclxuICAgKi9cclxuICBzY3JvbGxUb1JpZ2h0KGR1cmF0aW9uPzogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnNjcm9sbFhUbyh0aGlzLnZpZXcuc2Nyb2xsV2lkdGgsIGR1cmF0aW9uKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNjcm9sbCB2aWV3IHRvIG1heCBsZWZ0XHJcbiAgICogQHBhcmFtIGR1cmF0aW9uXHJcbiAgICovXHJcbiAgc2Nyb2xsVG9MZWZ0KGR1cmF0aW9uPzogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnNjcm9sbFhUbygwLCBkdXJhdGlvbik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgdGh1bWJuYWlsc1xyXG4gICAqL1xyXG4gIHVwZGF0ZSgpIHtcclxuICAgIHRoaXMuc2V0VGh1bWJYUG9zaXRpb24odGhpcy5fY3VyclhQb3MsIHRoaXMuY2FsY3VsYXRlVGh1bWJYU2l6ZSgpKTtcclxuICAgIHRoaXMuc2V0VGh1bWJZUG9zaXRpb24odGhpcy5fY3VycllQb3MsIHRoaXMuY2FsY3VsYXRlVGh1bWJZU2l6ZSgpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNjcm9sbCBXb3JrZXJcclxuICAgKiBAcGFyYW0gZSAtIE1vdXNlIEV2ZW50XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzY3JvbGxXb3JrZXIoZTogYW55KSB7XHJcbiAgICB0aGlzLl90aHVtYlNpemVYID0gdGhpcy50aHVtYlguY2xpZW50V2lkdGg7XHJcbiAgICB0aGlzLl90aHVtYlNpemVZID0gdGhpcy50aHVtYlkuY2xpZW50SGVpZ2h0O1xyXG5cclxuICAgIHRoaXMuX3RyYWNrTGVmdE1heCA9IHRoaXMuYmFyWC5jbGllbnRXaWR0aCAtIHRoaXMuX3RodW1iU2l6ZVg7XHJcbiAgICB0aGlzLl90cmFja1RvcE1heCA9IHRoaXMuYmFyWS5jbGllbnRIZWlnaHQgLSB0aGlzLl90aHVtYlNpemVZO1xyXG5cclxuICAgIGNvbnN0IHRodW1iWFBvc2l0aW9uID0gdGhpcy52aWV3LnNjcm9sbExlZnQgKiB0aGlzLl90cmFja0xlZnRNYXggLyB0aGlzLl9zY3JvbGxMZWZ0TWF4O1xyXG4gICAgY29uc3QgdGh1bWJZUG9zaXRpb24gPSB0aGlzLnZpZXcuc2Nyb2xsVG9wICogdGhpcy5fdHJhY2tUb3BNYXggLyB0aGlzLl9zY3JvbGxUb3BNYXg7XHJcblxyXG4gICAgdGhpcy5zZXRUaHVtYlhQb3NpdGlvbih0aHVtYlhQb3NpdGlvbiwgdGhpcy5jYWxjdWxhdGVUaHVtYlhTaXplKCkpO1xyXG4gICAgdGhpcy5zZXRUaHVtYllQb3NpdGlvbih0aHVtYllQb3NpdGlvbiwgdGhpcy5jYWxjdWxhdGVUaHVtYllTaXplKCkpO1xyXG5cclxuICAgIC8qKiBFbWl0IHNjcm9sbCBzdGF0ZSAqL1xyXG4gICAgdGhpcy5zY3JvbGxTdGF0ZS5lbWl0KGUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSG9yaXpvbnRhbCBzY3JvbGxiYXIgY2xpY2sgd29ya2VyXHJcbiAgICogQHBhcmFtIGUgLSBNb3VzZSBFdmVudFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYmFyWFdvcmtlcihlOiBhbnkpIHtcclxuICAgIGlmIChlLnRhcmdldCA9PT0gZS5jdXJyZW50VGFyZ2V0KSB7XHJcbiAgICAgIGNvbnN0IG9mZnNldCA9IGUub2Zmc2V0WCAtIHRoaXMuX25hdHVyYWxUaHVtYlNpemVYICogLjU7XHJcbiAgICAgIGNvbnN0IHRodW1iUG9zaXRpb25QZXJjZW50YWdlID0gb2Zmc2V0ICogMTAwIC8gdGhpcy5iYXJYLmNsaWVudFdpZHRoO1xyXG4gICAgICBjb25zdCBzY3JvbGxMZWZ0ID0gdGh1bWJQb3NpdGlvblBlcmNlbnRhZ2UgKiB0aGlzLnZpZXcuc2Nyb2xsV2lkdGggLyAxMDA7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy52aWV3LCAnc2Nyb2xsTGVmdCcsIHNjcm9sbExlZnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmVydGljYWwgc2Nyb2xsYmFyIGNsaWNrIHdvcmtlclxyXG4gICAqIEBwYXJhbSBlIC0gTW91c2UgRXZlbnRcclxuICAgKi9cclxuICBwcml2YXRlIGJhcllXb3JrZXIoZTogYW55KSB7XHJcbiAgICBpZiAoZS50YXJnZXQgPT09IGUuY3VycmVudFRhcmdldCkge1xyXG4gICAgICBjb25zdCBvZmZzZXQgPSBlLm9mZnNldFkgLSB0aGlzLl9uYXR1cmFsVGh1bWJTaXplWSAqIC41O1xyXG4gICAgICBjb25zdCB0aHVtYlBvc2l0aW9uUGVyY2VudGFnZSA9IG9mZnNldCAqIDEwMCAvIHRoaXMuYmFyWS5jbGllbnRIZWlnaHQ7XHJcbiAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IHRodW1iUG9zaXRpb25QZXJjZW50YWdlICogdGhpcy52aWV3LnNjcm9sbEhlaWdodCAvIDEwMDtcclxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLnZpZXcsICdzY3JvbGxUb3AnLCBzY3JvbGxUb3ApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgaG9yaXpvbnRhbCB0aHVtYiB3b3JrZXJcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXJ0VGh1bWJYV29ya2VyKCk6IFN1YnNjcmlwdGlvbiB7XHJcbiAgICBjb25zdCBtb3VzZWRvd24kID0gZnJvbUV2ZW50KHRoaXMudGh1bWJYLCAnbW91c2Vkb3duJyk7XHJcbiAgICBjb25zdCBtb3VzZXVwJCA9IGZyb21FdmVudCh0aGlzLmRvY3VtZW50LCAnbW91c2V1cCcpO1xyXG4gICAgY29uc3QgbW91c2Vtb3ZlJCA9IGZyb21FdmVudCh0aGlzLmRvY3VtZW50LCAnbW91c2Vtb3ZlJyk7XHJcbiAgICByZXR1cm4gbW91c2Vkb3duJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4gdGhpcy5kb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gKCkgPT4gZmFsc2UpLFxyXG4gICAgICBtYXAoKG1vdXNlZG93bkV2ZW50OiBhbnkpID0+IG1vdXNlZG93bkV2ZW50Lm9mZnNldFgpLFxyXG4gICAgICBtZXJnZU1hcCgobW91c2Vkb3duT2Zmc2V0WDogbnVtYmVyKSA9PiBtb3VzZW1vdmUkLnBpcGUoXHJcbiAgICAgICAgdGFrZVVudGlsKG1vdXNldXAkLnBpcGUodGFwKCgpID0+IHRoaXMuZG9jdW1lbnQub25zZWxlY3RzdGFydCA9IG51bGwpKSksXHJcbiAgICAgICAgbWFwKChtb3VzZW1vdmVFdmVudDogYW55KSA9PiBtb3VzZW1vdmVFdmVudC5jbGllbnRYKSxcclxuICAgICAgICB0YXAoKG1vdXNlbW92ZUNsaWVudFg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gbW91c2Vtb3ZlQ2xpZW50WCAtIHRoaXMuYmFyWC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xyXG4gICAgICAgICAgY29uc3Qgc2Nyb2xsID0gdGhpcy5fc2Nyb2xsTGVmdE1heCAqIChvZmZzZXQgLSBtb3VzZWRvd25PZmZzZXRYKSAvIHRoaXMuX3RyYWNrTGVmdE1heDtcclxuICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy52aWV3LCAnc2Nyb2xsTGVmdCcsIHNjcm9sbCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgKSlcclxuICAgICkuc3Vic2NyaWJlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGFydCB2ZXJ0aWNhbCB0aHVtYiB3b3JrZXJcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXJ0VGh1bWJZV29ya2VyKCk6IFN1YnNjcmlwdGlvbiB7XHJcbiAgICBjb25zdCBtb3VzZWRvd24kID0gZnJvbUV2ZW50KHRoaXMudGh1bWJZLCAnbW91c2Vkb3duJyk7XHJcbiAgICBjb25zdCBtb3VzZXVwJCA9IGZyb21FdmVudCh0aGlzLmRvY3VtZW50LCAnbW91c2V1cCcpO1xyXG4gICAgY29uc3QgbW91c2Vtb3ZlJCA9IGZyb21FdmVudCh0aGlzLmRvY3VtZW50LCAnbW91c2Vtb3ZlJyk7XHJcbiAgICByZXR1cm4gbW91c2Vkb3duJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4gdGhpcy5kb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gKCkgPT4gZmFsc2UpLFxyXG4gICAgICBtYXAoKG1vdXNlZG93bkV2ZW50OiBhbnkpID0+IG1vdXNlZG93bkV2ZW50Lm9mZnNldFkpLFxyXG4gICAgICBtZXJnZU1hcCgobW91c2Vkb3duT2Zmc2V0WTogbnVtYmVyKSA9PiBtb3VzZW1vdmUkLnBpcGUoXHJcbiAgICAgICAgdGFrZVVudGlsKG1vdXNldXAkLnBpcGUodGFwKCgpID0+IHRoaXMuZG9jdW1lbnQub25zZWxlY3RzdGFydCA9IG51bGwpKSksXHJcbiAgICAgICAgbWFwKChtb3VzZW1vdmVFdmVudDogYW55KSA9PiBtb3VzZW1vdmVFdmVudC5jbGllbnRZKSxcclxuICAgICAgICB0YXAoKG1vdXNlbW92ZUNsaWVudFk6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gbW91c2Vtb3ZlQ2xpZW50WSAtIHRoaXMuYmFyWS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XHJcbiAgICAgICAgICBjb25zdCBzY3JvbGwgPSB0aGlzLl9zY3JvbGxUb3BNYXggKiAob2Zmc2V0IC0gbW91c2Vkb3duT2Zmc2V0WSkgLyB0aGlzLl90cmFja1RvcE1heDtcclxuICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy52aWV3LCAnc2Nyb2xsVG9wJywgc2Nyb2xsKTtcclxuICAgICAgICB9KVxyXG4gICAgICApKVxyXG4gICAgKS5zdWJzY3JpYmUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGN1bGF0ZSBUaHVtYiBYIFNpemVcclxuICAgKi9cclxuICBwcml2YXRlIGNhbGN1bGF0ZVRodW1iWFNpemUoKTogbnVtYmVyIHtcclxuICAgIHRoaXMuX25hdHVyYWxUaHVtYlNpemVYID0gdGhpcy5iYXJYLmNsaWVudFdpZHRoIC8gdGhpcy52aWV3LnNjcm9sbFdpZHRoICogdGhpcy5iYXJYLmNsaWVudFdpZHRoO1xyXG4gICAgdGhpcy5fc2Nyb2xsTGVmdE1heCA9IHRoaXMudmlldy5zY3JvbGxXaWR0aCAtIHRoaXMudmlldy5jbGllbnRXaWR0aDtcclxuICAgIHJldHVybiB0aGlzLnNjcm9sbEJvdW5kYXJpZXModGhpcy5fbmF0dXJhbFRodW1iU2l6ZVgsIHRoaXMuX3Njcm9sbExlZnRNYXgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsY3VsYXRlIFRodW1iIFkgU2l6ZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2FsY3VsYXRlVGh1bWJZU2l6ZSgpOiBudW1iZXIge1xyXG4gICAgdGhpcy5fbmF0dXJhbFRodW1iU2l6ZVkgPSB0aGlzLmJhclkuY2xpZW50SGVpZ2h0IC8gdGhpcy52aWV3LnNjcm9sbEhlaWdodCAqIHRoaXMuYmFyWS5jbGllbnRIZWlnaHQ7XHJcbiAgICB0aGlzLl9zY3JvbGxUb3BNYXggPSB0aGlzLnZpZXcuc2Nyb2xsSGVpZ2h0IC0gdGhpcy52aWV3LmNsaWVudEhlaWdodDtcclxuICAgIHJldHVybiB0aGlzLnNjcm9sbEJvdW5kYXJpZXModGhpcy5fbmF0dXJhbFRodW1iU2l6ZVksIHRoaXMuX3Njcm9sbFRvcE1heCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgc2Nyb2xsYmFyIHRodW1iIHNpemVcclxuICAgKiBAcGFyYW0gbmF0dXJhbFRodW1iU2l6ZVxyXG4gICAqIEBwYXJhbSBzY3JvbGxNYXhcclxuICAgKi9cclxuICBwcml2YXRlIHNjcm9sbEJvdW5kYXJpZXMobmF0dXJhbFRodW1iU2l6ZTogbnVtYmVyLCBzY3JvbGxNYXg6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICByZXR1cm4gKG5hdHVyYWxUaHVtYlNpemUgPCB0aGlzLl9taW5UaHVtYlNpemUpID8gdGhpcy5fbWluVGh1bWJTaXplIDogc2Nyb2xsTWF4ID8gbmF0dXJhbFRodW1iU2l6ZSA6IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgaG9yaXpvbnRhbCBzY3JvbGxiYXIgdGh1bWIgc3R5bGVcclxuICAgKiBAcGFyYW0geFxyXG4gICAqIEBwYXJhbSB3aWR0aFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0VGh1bWJYUG9zaXRpb24oeDogbnVtYmVyLCB3aWR0aDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCB0cmFuc2Zvcm0gPSBgdHJhbnNsYXRlM2QoJHt4fXB4LCAwLCAwKWA7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMudGh1bWJYLCAndHJhbnNmb3JtJywgdHJhbnNmb3JtKTtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50aHVtYlgsICd3aWR0aCcsIHdpZHRoICsgJ3B4Jyk7XHJcbiAgICB0aGlzLl9jdXJyWFBvcyA9IHg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdmVydGljYWwgc2Nyb2xsYmFyIHRodW1iIHN0eWxlXHJcbiAgICogQHBhcmFtIHlcclxuICAgKiBAcGFyYW0gaGVpZ2h0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRUaHVtYllQb3NpdGlvbih5OiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCB0cmFuc2Zvcm0gPSBgdHJhbnNsYXRlM2QoMCwgJHt5fXB4LCAwKWA7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMudGh1bWJZLCAndHJhbnNmb3JtJywgdHJhbnNmb3JtKTtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50aHVtYlksICdoZWlnaHQnLCBoZWlnaHQgKyAncHgnKTtcclxuICAgIHRoaXMuX2N1cnJZUG9zID0geTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhpZGUgbmF0aXZlIHNjcm9sbGJhcnNcclxuICAgKi9cclxuICBwcml2YXRlIGhpZGVOYXRpdmVTY3JvbGxiYXJzKCkge1xyXG4gICAgY29uc3Qgc2l6ZSA9IGBjYWxjKDEwMCUgKyAke3RoaXMuZ2V0TmF0aXZlU2Nyb2xsYmFyV2lkdGgoKX1weClgO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnZpZXcsICd3aWR0aCcsIHNpemUpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnZpZXcsICdoZWlnaHQnLCBzaXplKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgbmF0aXZlIHNjcm9sbGJhciB3aWR0aFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0TmF0aXZlU2Nyb2xsYmFyV2lkdGgoKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICBlbGVtZW50LnN0eWxlLnRvcCA9ICctOTk5OXB4JztcclxuICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSAnMTAwcHgnO1xyXG4gICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnMTAwcHgnO1xyXG4gICAgZWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9ICdzY3JvbGwnO1xyXG4gICAgZWxlbWVudC5zdHlsZS5tc092ZXJmbG93U3R5bGUgPSAnc2Nyb2xsYmFyJztcclxuICAgIHRoaXMuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTtcclxuICAgIGNvbnN0IHN3ID0gZWxlbWVudC5vZmZzZXRXaWR0aCAtIGVsZW1lbnQuY2xpZW50V2lkdGg7XHJcbiAgICB0aGlzLmRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XHJcbiAgICByZXR1cm4gc3c7XHJcbiAgfVxyXG59XHJcbiJdfQ==